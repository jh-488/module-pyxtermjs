var e,t;e=self,t=()=>(()=>{var e={345:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=e=>(this._listeners.push(e),{dispose:()=>{if(!this._disposed){for(let t=0;t<this._listeners.length;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)}}})),this._event}fire(e,t){let i=[];for(let e=0;e<this._listeners.length;e++)i.push(this._listeners[e]);for(let s=0;s<i.length;s++)i[s].call(void 0,e,t)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(e,t){return e(e=>t.fire(e))}},859:(e,t)=>{function i(e){for(let t of e)t.dispose();e.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){for(let e of(this._isDisposed=!0,this._disposables))e.dispose();this._disposables.length=0}register(e){return this._disposables.push(e),e}unregister(e){let t=this._disposables.indexOf(e);-1!==t&&this._disposables.splice(t,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(e){var t;this._isDisposed||e===this._value||(null===(t=this._value)||void 0===t||t.dispose(),this._value=e)}clear(){this.value=void 0}dispose(){var e;this._isDisposed=!0,null===(e=this._value)||void 0===e||e.dispose(),this._value=void 0}},t.toDisposable=function(e){return{dispose:e}},t.disposeArray=i,t.getDisposeArrayDisposable=function(e){return{dispose:()=>i(e)}}}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,i),o.exports}var s={};return(()=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SearchAddon=void 0;let e=i(345),t=i(859),r=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class o extends t.Disposable{constructor(i){var s;super(),this._highlightedLines=new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new t.MutableDisposable),this._linesCacheTimeoutId=0,this._onDidChangeResults=this.register(new e.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=null!==(s=null==i?void 0:i.highlightLimit)&&void 0!==s?s:1e3}activate(e){this._terminal=e,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,t.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){var e;this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&(null===(e=this._lastSearchOptions)||void 0===e?void 0:e.decorations)&&(this._highlightTimeout=setTimeout(()=>{let e=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(e,Object.assign(Object.assign({},this._lastSearchOptions),{incremental:!0,noScroll:!0}))},200))}clearDecorations(e){this._selectedDecoration.clear(),(0,t.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),e||(this._cachedSearchTerm=void 0)}findNext(e,t){if(!this._terminal)throw Error("Cannot use addon until it has been loaded");this._lastSearchOptions=t,(null==t?void 0:t.decorations)&&(void 0!==this._cachedSearchTerm&&e===this._cachedSearchTerm||this._highlightAllMatches(e,t));let i=this._findNextAndSelect(e,t);return this._fireResults(t),this._cachedSearchTerm=e,i}_highlightAllMatches(e,t){if(!this._terminal)throw Error("Cannot use addon until it has been loaded");if(!e||0===e.length)return void this.clearDecorations();t=t||{},this.clearDecorations(!0);let i=[],s,r=this._find(e,0,0,t);for(;r&&((null==s?void 0:s.row)!==r.row||(null==s?void 0:s.col)!==r.col)&&!(i.length>=this._highlightLimit);)i.push(s=r),r=this._find(e,s.col+s.term.length>=this._terminal.cols?s.row+1:s.row,s.col+s.term.length>=this._terminal.cols?0:s.col+1,t);for(let e of i){let i=this._createResultDecoration(e,t.decorations);i&&(this._highlightedLines.add(i.marker.line),this._highlightDecorations.push({decoration:i,match:e,dispose(){i.dispose()}}))}}_find(e,t,i,s){var r;let o;if(!this._terminal||!e||0===e.length)return null===(r=this._terminal)||void 0===r||r.clearSelection(),void this.clearDecorations();if(i>this._terminal.cols)throw Error(`Invalid col: ${i} to search in terminal of ${this._terminal.cols} cols`);this._initLinesCache();let l={startRow:t,startCol:i};if(!(o=this._findInLine(e,l,s)))for(let i=t+1;i<this._terminal.buffer.active.baseY+this._terminal.rows&&(l.startRow=i,l.startCol=0,!(o=this._findInLine(e,l,s)));i++);return o}_findNextAndSelect(e,t){var i;if(!this._terminal||!e||0===e.length)return null===(i=this._terminal)||void 0===i||i.clearSelection(),this.clearDecorations(),!1;let s=this._terminal.getSelectionPosition();this._terminal.clearSelection();let r=0,o=0;s&&(this._cachedSearchTerm===e?(r=s.end.x,o=s.end.y):(r=s.start.x,o=s.start.y)),this._initLinesCache();let l={startRow:o,startCol:r},n=this._findInLine(e,l,t);if(!n)for(let i=o+1;i<this._terminal.buffer.active.baseY+this._terminal.rows&&(l.startRow=i,l.startCol=0,!(n=this._findInLine(e,l,t)));i++);if(!n&&0!==o)for(let i=0;i<o&&(l.startRow=i,l.startCol=0,!(n=this._findInLine(e,l,t)));i++);return!n&&s&&(l.startRow=s.start.y,l.startCol=0,n=this._findInLine(e,l,t)),this._selectResult(n,null==t?void 0:t.decorations,null==t?void 0:t.noScroll)}findPrevious(e,t){if(!this._terminal)throw Error("Cannot use addon until it has been loaded");this._lastSearchOptions=t,(null==t?void 0:t.decorations)&&(void 0!==this._cachedSearchTerm&&e===this._cachedSearchTerm||this._highlightAllMatches(e,t));let i=this._findPreviousAndSelect(e,t);return this._fireResults(t),this._cachedSearchTerm=e,i}_fireResults(e){if(null==e?void 0:e.decorations){let e=-1;if(this._selectedDecoration.value){let t=this._selectedDecoration.value.match;for(let i=0;i<this._highlightDecorations.length;i++){let s=this._highlightDecorations[i].match;if(s.row===t.row&&s.col===t.col&&s.size===t.size){e=i;break}}}this._onDidChangeResults.fire({resultIndex:e,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(e,t){var i;let s;if(!this._terminal)throw Error("Cannot use addon until it has been loaded");if(!this._terminal||!e||0===e.length)return null===(i=this._terminal)||void 0===i||i.clearSelection(),this.clearDecorations(),!1;let r=this._terminal.getSelectionPosition();this._terminal.clearSelection();let o=this._terminal.buffer.active.baseY+this._terminal.rows-1,l=this._terminal.cols;this._initLinesCache();let n={startRow:o,startCol:l};if(r&&(n.startRow=o=r.start.y,n.startCol=l=r.start.x,this._cachedSearchTerm!==e&&((s=this._findInLine(e,n,t,!1))||(n.startRow=o=r.end.y,n.startCol=l=r.end.x))),s||(s=this._findInLine(e,n,t,!0)),!s){n.startCol=Math.max(n.startCol,this._terminal.cols);for(let i=o-1;i>=0&&(n.startRow=i,!(s=this._findInLine(e,n,t,!0)));i--);}if(!s&&o!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let i=this._terminal.buffer.active.baseY+this._terminal.rows-1;i>=o&&(n.startRow=i,!(s=this._findInLine(e,n,t,!0)));i--);return this._selectResult(s,null==t?void 0:t.decorations,null==t?void 0:t.noScroll)}_initLinesCache(){let e=this._terminal;this._linesCache||(this._linesCache=Array(e.buffer.active.length),this._cursorMoveListener=e.onCursorMove(()=>this._destroyLinesCache()),this._resizeListener=e.onResize(()=>this._destroyLinesCache())),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._cursorMoveListener&&(this._cursorMoveListener.dispose(),this._cursorMoveListener=void 0),this._resizeListener&&(this._resizeListener.dispose(),this._resizeListener=void 0),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(e,t,i){return(0===e||r.includes(t[e-1]))&&(e+i.length===t.length||r.includes(t[e+i.length]))}_findInLine(e,t,i={},s=!1){var r;let o=this._terminal,l=t.startRow,n=t.startCol,h=o.buffer.active.getLine(l);if(null==h?void 0:h.isWrapped)return s?void(t.startCol+=o.cols):(t.startRow--,t.startCol+=o.cols,this._findInLine(e,t,i));let a=null===(r=this._linesCache)||void 0===r?void 0:r[l];a||(a=this._translateBufferLineToStringWithWrap(l,!0),this._linesCache&&(this._linesCache[l]=a));let[c,d]=a,_=this._bufferColsToStringOffset(l,n),u=i.caseSensitive?e:e.toLowerCase(),f=i.caseSensitive?c:c.toLowerCase(),g=-1;if(i.regex){let t;let i=RegExp(u,"g");if(s)for(;t=i.exec(f.slice(0,_));)g=i.lastIndex-t[0].length,e=t[0],i.lastIndex-=e.length-1;else(t=i.exec(f.slice(_)))&&t[0].length>0&&(g=_+(i.lastIndex-t[0].length),e=t[0])}else s?_-u.length>=0&&(g=f.lastIndexOf(u,_-u.length)):g=f.indexOf(u,_);if(g>=0){if(i.wholeWord&&!this._isWholeWord(g,f,e))return;let t=0;for(;t<d.length-1&&g>=d[t+1];)t++;let s=t;for(;s<d.length-1&&g+e.length>=d[s+1];)s++;let r=g-d[t],n=g+e.length-d[s],h=this._stringLengthToBufferSize(l+t,r);return{term:e,col:h,row:l+t,size:this._stringLengthToBufferSize(l+s,n)-h+o.cols*(s-t)}}}_stringLengthToBufferSize(e,t){let i=this._terminal.buffer.active.getLine(e);if(!i)return 0;for(let e=0;e<t;e++){let s=i.getCell(e);if(!s)break;let r=s.getChars();r.length>1&&(t-=r.length-1);let o=i.getCell(e+1);o&&0===o.getWidth()&&t++}return t}_bufferColsToStringOffset(e,t){let i=this._terminal,s=e,r=0,o=i.buffer.active.getLine(s);for(;t>0&&o;){for(let e=0;e<t&&e<i.cols;e++){let t=o.getCell(e);if(!t)break;t.getWidth()&&(r+=0===t.getCode()?1:t.getChars().length)}if(s++,(o=i.buffer.active.getLine(s))&&!o.isWrapped)break;t-=i.cols}return r}_translateBufferLineToStringWithWrap(e,t){var i;let s=this._terminal,r=[],o=[0],l=s.buffer.active.getLine(e);for(;l;){let n=s.buffer.active.getLine(e+1),h=!!n&&n.isWrapped,a=l.translateToString(!h&&t);if(h&&n){let e=l.getCell(l.length-1);e&&0===e.getCode()&&1===e.getWidth()&&2===(null===(i=n.getCell(0))||void 0===i?void 0:i.getWidth())&&(a=a.slice(0,-1))}if(r.push(a),!h)break;o.push(o[o.length-1]+a.length),e++,l=n}return[r.join(""),o]}_selectResult(e,i,s){let r=this._terminal;if(this._selectedDecoration.clear(),!e)return r.clearSelection(),!1;if(r.select(e.col,e.row,e.size),i){let s=r.registerMarker(-r.buffer.active.baseY-r.buffer.active.cursorY+e.row);if(s){let o=r.registerDecoration({marker:s,x:e.col,width:e.size,backgroundColor:i.activeMatchBackground,layer:"top",overviewRulerOptions:{color:i.activeMatchColorOverviewRuler}});if(o){let r=[];r.push(s),r.push(o.onRender(e=>this._applyStyles(e,i.activeMatchBorder,!0))),r.push(o.onDispose(()=>(0,t.disposeArray)(r))),this._selectedDecoration.value={decoration:o,match:e,dispose(){o.dispose()}}}}}if(!s&&(e.row>=r.buffer.active.viewportY+r.rows||e.row<r.buffer.active.viewportY)){let t=e.row-r.buffer.active.viewportY;t-=Math.floor(r.rows/2),r.scrollLines(t)}return!0}_applyStyles(e,t,i){e.classList.contains("xterm-find-result-decoration")||(e.classList.add("xterm-find-result-decoration"),t&&(e.style.outline=`1px solid ${t}`)),i&&e.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(e,i){let s=this._terminal,r=s.registerMarker(-s.buffer.active.baseY-s.buffer.active.cursorY+e.row);if(!r)return;let o=s.registerDecoration({marker:r,x:e.col,width:e.size,backgroundColor:i.matchBackground,overviewRulerOptions:this._highlightedLines.has(r.line)?void 0:{color:i.matchOverviewRuler,position:"center"}});if(o){let e=[];e.push(r),e.push(o.onRender(e=>this._applyStyles(e,i.matchBorder,!1))),e.push(o.onDispose(()=>(0,t.disposeArray)(e)))}return o}}s.SearchAddon=o})(),s})(),"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.SearchAddon=t():e.SearchAddon=t();
//# sourceMappingURL=index.09b6c50e.js.map
